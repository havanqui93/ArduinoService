@using ArduinoService.Resource
@{
    ViewBag.Title = "Control Systems ioT";
}
<style>
    .control-system {
        margin-top: 50px;
    }

        .control-system .btn {
            width: 100px !important;
            height: 50px !important;
            border: none;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }

    .status {
        font-size: 15px;
        padding: 10px;
    }

    #contain {
        text-align: center;
    }

    .box-shadow {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    }

    .title-boxshadow {
        padding-top: 10px;
        padding-bottom: 10px;
        border-bottom: 1px solid #D4CDCD;
        margin-bottom: 10px;
        width: 60%;
        text-align: center;
        margin: 10px auto;
    }

    .margin-bottom-10 {
        margin-bottom: 10px;
    }

    .ctrl {
        padding-bottom: 25px;
    }
</style>

<div class="control-system" id="contain">
    <div class="col-sm-4 margin-bottom-10">
        <div class="box-shadow">
            <div class="title-boxshadow col-sm-12">1</div>
            <div class="col-sm-12 ctrl">
                <button class="btn btn-default flat" attrControl="LED" value="ON">@Languages._0006</button>
                <button class="btn btn-default flat" attrControl="LED" value="OFF">@Languages._0007</button>
                @*<div class="status" attr_status="LED"></div>*@
            </div>
        </div>
    </div>

    <div class="col-sm-4 margin-bottom-10">
        <div class="box-shadow">
            <div class="title-boxshadow col-sm-12">2</div>
            <div class="col-sm-12 ctrl">
                <button class="btn btn-default flat" attrControl="WATER" value="ON">@Languages._0006</button>
                <button class="btn btn-default flat" attrControl="WATER" value="OFF">@Languages._0007</button>
                @*<div class="status" attr_status="WATER"></div>*@
            </div>
        </div>
    </div>

    <div class="col-sm-4 margin-bottom-10">
        <div class="box-shadow">
            <div class="title-boxshadow col-sm-12">3</div>
            <div class="col-sm-12 ctrl">
                <button class="btn btn-default flat" attrControl="WIND" value="ON">@Languages._0006</button>
                <button class="btn btn-default flat" attrControl="WIND" value="OFF">@Languages._0007</button>
                @*<div class="status" attr_status="WIND"></div>*@
            </div>
        </div>
    </div>

    <div class="col-sm-4 margin-bottom-10">
        <div class="box-shadow">
            <div class="title-boxshadow col-sm-12">4</div>
            <div class="col-sm-12 ctrl">
                <button class="btn btn-default flat" attrControl="MODULE4" value="ON">@Languages._0006</button>
                <button class="btn btn-default flat" attrControl="MODULE4" value="OFF">@Languages._0007</button>
                @*<div class="status" attr_status="WIND"></div>*@
            </div>
        </div>
    </div>


</div>
@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.LedHub;
            // Create a function that the hub can call back to display messages.
            chat.client.SendClient = function (lstControl) {
                // Get Message
                var object = JSON.parse(lstControl);
                $('button').removeClass('btn-success');
                $('button[value="' + object[0].LED + '"][attrControl="LED"]').addClass('btn-success');
                $('button[value="' + object[0].WATER + '"][attrControl="WATER"]').addClass('btn-success');
                $('button[value="' + object[0].WIND + '"][attrControl="WIND"]').addClass('btn-success');
                $('button[value="' + object[0].MODULE4 + '"][attrControl="MODULE4"]').addClass('btn-success');

                @*$('.status[attr_status="LED"]').text(object[0].LED == "ON" ? '@Html.Raw(Languages._0016)' : '@Html.Raw(Languages._0017)');
                $('.status[attr_status="WATER"]').text(object[0].WATER == "ON" ? '@Html.Raw(Languages._0016)' : '@Html.Raw(Languages._0017)');
                $('.status[attr_status="WIND"]').text(object[0].WIND == "ON" ? '@Html.Raw(Languages._0016)' : '@Html.Raw(Languages._0017)');*@
            };

            $.connection.hub.start().done(function () {
                var val = GetData();
                // Call the Send method on the hub.
                chat.server.send(val);
            });
        });

        var url = "/api/LedApi";

        function GetData() {
            var result = null;
            $.ajax({
                method: "GET",
                async: false,
                url: url,
            }).success(function (msg) {
                result = msg;
            });
            return result;
        }

        $('button').on('click', function () {
            var control = $(this).attr('attrcontrol');
            var status = $(this).val();

            var data = { 'control': control, 'status': status };
            UpdateData(data);
        });

        function UpdateData(data) {
            $.ajax({
                method: "POST",
                url: url,
                contentType: "application/json",
                data: JSON.stringify(data)
            }).success(function (msg) {
                var chat = $.connection.LedHub;
                var val = GetData();
                // Call the Send method on the hub.
                chat.server.send(val);
            });
        }

    </script>
}